<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <link href="../icons/icon.png" rel="icon" type="image/png">
    <title>Backyard Bandwidth â€¢ Anova</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3/dist/purify.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/styles/github.min.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/marked-katex-extension@4.0.4/lib/index.umd.min.js"></script>

<script>
    window.addEventListener("DOMContentLoaded", () => {
      // Base marked options
      marked.setOptions({
        gfm: true,
        breaks: true,
        smartLists: true,
        smartypants: false,
        highlight: (code, lang) => {
          try {
            if (window.hljs) {
              if (lang && hljs.getLanguage(lang)) {
                return hljs.highlight(code, { language: lang }).value;
              }
              return hljs.highlightAuto(code).value;
            }
          } catch (e) {
            console.warn("HLJS highlight error:", e);
          }
          return code;
        }
      });

      // Use KaTeX extension
      if (window.markedKatex) {
        marked.use(window.markedKatex({
          katex: window.katex,
          output: "html",
          throwOnError: false,
          delimiters: [
            { left: "$$", right: "$$", display: true },   // block math
            { left: "$", right: "$", display: false },    // inline math
            { left: "\\(", right: "\\)", display: false }, // inline alt
            { left: "\\[", right: "\\]", display: true }   // block alt
          ]
        }));
      } else {
        console.error("marked-katex-extension not loaded.");
      }
    });
</script>


    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bLightBlue: "#6ec1e4",
                        bLightBlueHover: "#008CCB",
                        bDarkBlue: "#2d6ea8",
                        bDarkGrey: "#1A1A1A",
                        bLightGrey: "#aaa",
                        bGreyHover: "#81868c",
                        bGreen: "#4caf50",
                        bGreenHover: "#008000FF",
                        bRed: "#E33434",
                        bRedHover: "#972424"
                    }
                }
            }
        }
    </script>
    <style>
        .scroll-shadow {
            mask-image: linear-gradient(to bottom, transparent, black 16px, black calc(100% - 16px), transparent);
        }

        body {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }

        .bubble pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .typing {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            height: 1em;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 9999px;
            background: #9ca3af;
            opacity: 0.35;
            animation: typing-bounce 1s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: .2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: .4s;
        }

        @keyframes typing-bounce {
            0%, 80%, 100% {
                transform: translateY(0);
                opacity: .35;
            }
            40% {
                transform: translateY(-5px);
                opacity: 1;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .typing-dot {
                animation: none;
                opacity: .75;
            }
        }

        .bubble .md pre {
            padding: 0.75rem 1rem;
            margin: 0.85rem 0;
            border-radius: 0.5rem;
            background: #f6f8fa;
            border: 1px solid #e5e7eb;
            overflow: auto;
        }

        .bubble .md pre > code {
            display: block;
            padding: 0;
            background: transparent;
        }

        .bubble .md :not(pre) > code {
            background: #f3f4f6;
            padding: 0.15rem 0.35rem;
            border-radius: 0.25rem;
        }
    </style>
</head>

<body class="bg-gray-100 h-dvh flex flex-col overflow-hidden" onload="boot()">

<header class="w-full bg-black text-white flex items-center justify-between px-6 py-2 shadow-md">
    <div class="flex items-center space-x-3">
        <a href="../index.html">
            <img alt="Logo" class="max-h-14 w-auto object-contain"
                 src="data:image/png;base64,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"/>
        </a>
        <span class="text-lg font-bold tracking-wide">Backyard Bandwidth â€¢ Anova</span>
        <span class="ml-3 text-xs bg-bDarkBlue/60 px-2 py-0.5 rounded hidden" id="env-pill"
              style="display: none"></span>
    </div>

    <div class="flex items-center gap-2">
        <span class="hidden" id="customer-username"></span>
        <span class="text-xs bg-bDarkBlue/60 text-white px-2 py-0.5 rounded" id="token-pill"
              style="display: none"
              title="Total tokens used this session">
  Tokens used: <span id="token-count">0</span>
</span>
        <a class="bg-bLightGrey hover:bg-bGreyHover text-black px-4 py-2 rounded text-sm font-semibold"
           href="dashboard.html" target="_blank">Dashboard</a>
        <a class="bg-bLightGrey hover:bg-bGreyHover text-black px-4 py-2 rounded text-sm font-semibold"
           href="../anova-policy.html" target="_blank">Policy</a>
        <button class="bg-bRed hover:bg-bRedHover text-white px-4 py-2 rounded text-sm font-semibold"
                onclick="logout()">Logout
        </button>
    </div>
</header>

<!-- Main -->
<main class="max-w-7xl mx-auto p-4 flex-1 min-h-0 flex overflow-hidden">
    <!-- Card -->
    <section class="bg-white rounded-2xl shadow-lg p-4 md:p-6 flex-1 flex flex-col min-h-0 overflow-hidden">
        <div class="flex items-center justify-between mb-4">
            <h1 class="text-xl font-bold text-gray-800">Ask Anova</h1>
            <div class="flex items-center gap-2">
                <button class="text-sm text-white px-3 py-1.5 rounded bg-bRed hover:bg-bRedHover" id="btn-clear"
                        onclick="clearChat()" title="Clear chat">Clear Chat
                </button>
                <button class="text-sm px-3 py-1.5 rounded bg-bGreen hover:bg-bGreenHover text-white"
                        id="btn-copy"
                        onclick="copyLast()" title="Copy last AI reply">Copy Last
                </button>
                <button class="text-sm px-3 py-1.5 rounded bg-bLightBlue hover:bg-bLightBlueHover text-white"
                        id="btn-export"
                        onclick="exportChat()" title="Download chat as PDF">Export PDF
                </button>
            </div>

        </div>

        <!-- Messages -->
        <div class="scroll-shadow flex-1 min-h-0 overflow-y-auto pr-1 space-y-3 bg-gray-50 rounded-lg p-3 border border-gray-200"
             id="messages">
            <!-- Bubbles will be appended here -->
            <div class="bubble flex items-start gap-3">
                <div class="w-8 h-8 rounded-full flex-shrink-0 bg-bDarkGrey text-white grid place-items-center font-bold">
                    BB
                </div>
                <div class="max-w-[92%] md:max-w-[85%] bg-white border border-gray-200 rounded-xl p-3 text-sm leading-relaxed">
<pre>
You are now connected with Anova â€” a stateless LLM built for privacy. Anova never saves, logs, or remembers your input. Each message is processed in real time, then wiped from memory. By using Anova, you accept our <u><a
        href="../anova-policy.html"
        target="_blank">Stateless LLM Policy</a></u>. Your data stays yours. Press Enter to send, or Shift+Enter for a new line.
</pre>
                </div>
            </div>
        </div>

        <!-- Composer -->
        <div class="mt-4 grid grid-cols-1 gap-2">
            <div class="relative">
                <textarea
                        class="w-full border border-gray-300 rounded-xl p-3 pr-24 min-h-[96px] resize-none focus:outline-none focus:ring-2 focus:ring-bLightBlue"
                        id="input"
                        onkeydown="handleKey(event)"
                        placeholder="Your data. Your freedom. Your privacy. Ask anything..."
                        style="height: 128px;"></textarea>
                <!-- Corner resize control -->
                <div aria-hidden="false"
                     class="absolute right-[84px] bottom-2 flex flex-col gap-1 select-none" id="input-resize-controls">
                    <button class="h-6 w-6 grid place-items-center rounded bg-white border border-gray-300 text-xs hover:bg-gray-50 shadow-sm"
                            onclick="adjustInputHeight(1)"
                            title="Increase input height (Ctrl + =)"
                            type="button">ï¼‹
                    </button>
                    <button class="h-6 w-6 grid place-items-center rounded bg-white border border-gray-300 text-xs hover:bg-gray-50 shadow-sm"
                            onclick="adjustInputHeight(-1)"
                            title="Decrease input height (Ctrl + -)"
                            type="button">âˆ’
                    </button>
                </div>


                <div class="absolute right-2 bottom-2 flex gap-2">
                    <!-- Debug toggle for reproducing unsuccessful (omit username) -->
                    <label class="hidden items-center gap-1 text-xs text-gray-500 mr-2 select-none" id="omit-user-wrap"
                           title="For testing unsuccessful requests (success: false)">
                        <input class="accent-bRed" id="omit-username" style="display: none" type="checkbox">
                        <!--            omit username-->
                    </label>
                    <button class="bg-bGreen hover:bg-bGreenHover text-white px-4 py-2 rounded font-semibold"
                            id="send-btn"
                            onclick="sendMessage()">Send
                    </button>
                </div>
            </div>

            <div class="text-xs text-gray-600 flex flex-col space-y-1">
                <span>Press <b>Enter</b> to send â€¢ <b>Shift + Enter</b> for a new line</span>
                <span>Press <b>Control + =</b> to increase input height â€¢ <b>Control + -</b> to decrease input height</span>
                <span><b>Reminder:</b> Anova isnâ€™t perfect â€” always double-check important info</span>
                <span class="hidden" id="status"></span>
            </div>

        </div>
    </section>
</main>

<div class="fixed inset-0 bg-black/40 backdrop-blur-[1px] hidden items-center justify-center z-50"
     id="thinking-overlay">
    <div class="bg-white rounded-2xl shadow-xl px-6 py-5 text-center w-[92%] max-w-sm border border-gray-200">
        <div class="mx-auto mb-3 h-10 w-10 rounded-full border-4 border-bLightBlue border-t-transparent animate-spin"></div>
        <div class="text-base font-semibold tracking-wide" id="thinking-text">thinking..</div>
        <!--    <div class="mt-1 text-xs text-gray-500">Anova is cooking your answer</div>-->
    </div>
</div>

<script>
    let API_BASE_URL = "";
    let TOKEN = "";
    let USERNAME = "";
    let totalTokens = 0;

    async function ensureHljs() {
        if (window.hljs) return true;
        try {
            await new Promise((resolve, reject) => {
                const s = document.createElement('script');
                s.src = "https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/build/highlight.min.js";
                s.onload = resolve;
                s.onerror = reject;
                document.head.appendChild(s);
            });
            return !!window.hljs;
        } catch (e) {
            console.warn("Failed to load highlight.js dynamically:", e);
            return false;
        }
    }

    function addTokens(n) {
        const v = Number(n) || 0;
        totalTokens += v;
        const el = document.getElementById('token-count');
        if (el) el.textContent = totalTokens.toLocaleString();
    }

    async function boot() {
        try {
            const isDev =
                location.hostname.includes("localhost") ||
                location.hostname === "127.0.0.1";

            let config = {dev: "", prod: ""};
            try {
                const envRes = await fetch("../data/env.json", {cache: "no-store"});
                if (envRes.ok) config = await envRes.json();
                else console.warn("env.json fetch failed:", envRes.status);
            } catch (e) {
                console.warn("env.json fetch threw:", e);
            }

            if (!config.dev && !config.prod) {
                console.warn("env.json missing; defaulting API_BASE_URL to /api");
                config = {dev: "/api", prod: "/api"};
            }

            API_BASE_URL = isDev ? config.dev : config.prod;

            const envPill = document.getElementById("env-pill");
            if (API_BASE_URL) {
                envPill.textContent = `${isDev ? "DEV" : "PROD"}: ${API_BASE_URL}`;
                envPill.classList.remove("hidden");
            } else {
                toast("No API base set (check env.json).");
            }

            const raw = localStorage.getItem("dashboardData");
            if (!raw) return redirect();

            const parsed = JSON.parse(raw);
            if (Date.now() > (parsed.expires || 0)) {
                localStorage.removeItem("dashboardData");
                return redirect();
            }
            const data = parsed.data || {};
            TOKEN = data.token || "";
            USERNAME = (data.customer_username || "").trim();


            const u = document.getElementById("customer-username");
            if (u && USERNAME) u.textContent = USERNAME;


            if (isDev) document.getElementById("omit-user-wrap").classList.remove("hidden");


            document.getElementById("input").focus();
        } catch (e) {
            console.error(e);
            redirect();
        }
    }

    function redirect() {
        window.location = "login.html";
    }

    function logout() {
        localStorage.removeItem("dashboardData");
        redirect();
    }


    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("input");
    const sendBtn = document.getElementById("send-btn");

    let inflight = false;
    let currentAbort = null;
    let inlineThink = null;

    function handleKey(e) {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            if (inflight) {
                cancelRequest("Stopped by keyboard");
            } else {
                sendMessage();
            }
        }
        if (e.key === "Escape" && inflight) {
            e.preventDefault();
            cancelRequest("Stopped");
        }
    }

    function appendBubble({role, text, success = null}) {
        const wrap = document.createElement("div");
        wrap.className = "bubble flex items-start gap-3";

        const avatar = document.createElement("div");
        avatar.className = "w-8 h-8 rounded-full flex-shrink-0 grid place-items-center font-bold";
        if (role === "user") {
            const initial = getUserInitial();
            avatar.textContent = initial;
            avatar.title = USERNAME || "";
            avatar.classList.add("bg-bLightBlue", "text-white");
        } else if (role === "assistant") {
            avatar.textContent = "A";
            avatar.classList.add("bg-bDarkBlue", "text-white");
        } else {
            avatar.textContent = "!";
            avatar.classList.add("bg-bRed", "text-white");
        }

        const bubble = document.createElement("div");
        bubble.className = "relative max-w-[92%] md:max-w-[85%] rounded-xl p-3 text-sm leading-relaxed";
        if (role === "user") {
            bubble.classList.add("bg-bLightBlue", "text-white");
        } else if (role === "assistant") {
            bubble.classList.add("bg-white", "border", "border-gray-200");
        } else {
            bubble.classList.add("bg-white", "border", "border-bRed");
        }

        const originalMD = String(text || "");
        bubble.dataset.md = originalMD;

        let contentEl;
        if (role === "assistant") {
            const html = DOMPurify.sanitize(marked.parse(originalMD || ""), {USE_PROFILES: {html: true}});
            contentEl = document.createElement("div");
            contentEl.className = "md";
            contentEl.innerHTML = html || "<pre></pre>";

            (async () => {
                const ok = await ensureHljs();
                if (ok && window.hljs) {
                    try {
                        contentEl.querySelectorAll("pre code").forEach((codeEl) => {
                            hljs.highlightElement(codeEl);
                        });
                    } catch (e) {
                        console.warn("highlightElement failed:", e);
                    }
                }
            })();
            contentEl.querySelectorAll("pre").forEach((pre) => {
                pre.classList.add(
                    "relative", "group",
                    "rounded-lg", "border", "border-gray-200",
                    "bg-gray-50", "p-4", "my-3", "overflow-auto"
                );
                const btn = document.createElement("button");
                btn.type = "button";
                btn.title = "Copy code";
                btn.textContent = "Copy";
                btn.className = "hidden group-hover:block absolute top-2 right-2 text-[10px] bg-bLightGrey hover:bg-bGreyHover text-black px-2 py-0.5 rounded border border-gray-300";
                btn.addEventListener("click", async () => {
                    const code = pre.querySelector("code");
                    const toCopy = code ? code.innerText : pre.innerText;
                    await copyString(toCopy);
                });
                pre.appendChild(btn);
            });
        } else {
            contentEl = document.createElement("pre");
            contentEl.textContent = originalMD;
        }
        bubble.appendChild(contentEl);


        if (success === false) {
            const row = document.createElement("div");
            row.className = "mt-2 flex items-center justify-between gap-3 text-xs";
            const pill = document.createElement("span");
            pill.className = "px-2 py-0.5 rounded font-semibold bg-red-100 text-red-700";
            pill.textContent = "Unable to perform request";
            row.appendChild(pill);
            bubble.appendChild(row);
        }

        wrap.appendChild(avatar);
        wrap.appendChild(bubble);
        messagesEl.appendChild(wrap);
        messagesEl.scrollTop = messagesEl.scrollHeight;
        return wrap;
    }

    function clearChat() {
        messagesEl.innerHTML = "";
        totalTokens = 0;
        const el = document.getElementById('token-count');
        if (el) el.textContent = "0";
        messagesEl.innerHTML = "            <div class=\"bubble flex items-start gap-3\">\n" +
            "                <div class=\"w-8 h-8 rounded-full flex-shrink-0 bg-bDarkGrey text-white grid place-items-center font-bold\">\n" +
            "                    BB\n" +
            "                </div>\n" +
            "                <div class=\"max-w-[92%] md:max-w-[85%] bg-white border border-gray-200 rounded-xl p-3 text-sm leading-relaxed\">\n" +
            "<pre>\n" +
            "You are now connected with Anova â€” a stateless LLM built for privacy. Anova never saves, logs, or remembers your input. Each message is processed in real time, then wiped from memory. By using Anova, you accept our <u><a href=\"../anova-policy.html\">Stateless LLM Policy</a></u>. Your data stays yours. Press Enter to send, or Shift+Enter for a new line.\n" +
            "</pre>                </div>\n" +
            "            </div>";
    }

    function copyLast() {
        const bubbles = messagesEl.querySelectorAll(".bubble");

        for (let i = bubbles.length - 1; i >= 0; i--) {
            const label = bubbles[i].querySelector(".w-8");
            if (!label) continue;
            const isAssistant = label.textContent === "A" || label.textContent === "BB";
            if (isAssistant) {
                const md = bubbles[i].querySelector(".relative")?.dataset?.md;
                if (md) {
                    copyString(md);
                    return;
                }

                const pre = bubbles[i].querySelector("pre");
                const text = pre?.textContent || bubbles[i].innerText || "";
                copyString(text);
                return;
            }
        }
        toast("No AI reply to copy yet.");
    }


    function toast(msg) {
        const s = document.getElementById("status");
        s.textContent = msg;
        s.classList.remove("hidden");
        setTimeout(() => s.classList.add("hidden"), 1500);
    }

    let thinkingTimer = null;

    function showThinking() {

    }

    function hideThinking() {

    }

    function createThinkingBubble() {

        const wrap = appendBubble({role: "assistant", text: ""});


        const md = wrap.querySelector(".md");
        const pre = wrap.querySelector("pre");
        const target = md || pre || wrap;
        target.innerHTML = "";
        target.appendChild(makeTypingDots());

        return {
            remove: () => wrap.remove(),
            el: wrap
        };
    }


    async function sendMessage() {
        if (inflight) {
            cancelRequest("Stopped");
            return;
        }

        const prompt = (inputEl.value || "").trim();
        if (!prompt) {
            toast("Type something first.");
            return;
        }

        appendBubble({role: "user", text: prompt});
        inputEl.value = "";
        inputEl.style.height = "auto";

        inflight = true;
        setSendButtonMode("stop");
        inlineThink = createThinkingBubble();
        currentAbort = new AbortController();

        try {
            const body = {token: TOKEN, username: USERNAME, prompt};
            const res = await fetch(`${API_BASE_URL}/user/llm/send`, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(body),
                signal: currentAbort.signal
            });

            if (currentAbort.signal.aborted) throw new DOMException("Aborted", "AbortError");

            const json = await res.json().catch(() => ({}));
            if (currentAbort.signal.aborted) throw new DOMException("Aborted", "AbortError");

            const success = !!json.success;
            const reply = (json.data?.answer || json?.error?.msg || "No reply");

            inlineThink?.remove();
            inlineThink = null;

            appendBubble({
                role: success ? "assistant" : "error",
                text: reply,
                success
            });
        } catch (err) {
            inlineThink?.remove();
            inlineThink = null;

            if (err?.name === "AbortError") {
                appendBubble({
                    role: "error",
                    text: "User stopped request",
                    success: false
                });
            } else {
                appendBubble({
                    role: "error",
                    text: `Network error: ${err?.message || err}`,
                    success: false
                });
            }
        } finally {
            inflight = false;
            currentAbort = null;
            setSendButtonMode("send");
            inputEl.focus();
        }
    }

    async function copyString(text) {
        try {
            await navigator.clipboard.writeText(text);
            toast("Copied.");
        } catch (e) {
            console.error(e);
            toast("Copy failed");
        }
    }

    function makeTypingDots() {
        const wrap = document.createElement('span');
        wrap.className = 'typing';
        wrap.setAttribute('aria-label', 'Assistant is typing');
        wrap.setAttribute('role', 'status');

        for (let i = 0; i < 3; i++) {
            const d = document.createElement('span');
            d.className = 'typing-dot';
            wrap.appendChild(d);
        }
        return wrap;
    }

    function getUserInitial() {
        const u = (USERNAME || "").trim();
        if (!u) return "U";
        const m = u.match(/[A-Za-z0-9]/);
        return (m ? m[0] : u[0]).toUpperCase();
    }

    function exportChat() {
        const container = document.getElementById('messages');
        if (!container) return toast("No chat to export.");

        const wrapper = document.createElement('div');
        wrapper.style.padding = '16px';
        wrapper.style.fontFamily = 'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial';

        const title = document.createElement('div');
        title.style.fontSize = '18px';
        title.style.fontWeight = '700';
        title.style.marginBottom = '4px';
        title.textContent = 'Backyard Bandwidth â€¢ Anova â€” Chat Export';

        const subtitle = document.createElement('div');
        subtitle.style.fontSize = '12px';
        subtitle.style.color = '#6b7280';
        subtitle.style.marginBottom = '12px';
        const now = new Date();
        subtitle.textContent = `Exported: ${now.toLocaleString()}` + (typeof USERNAME === 'string' && USERNAME ? ` â€¢ User: ${USERNAME}` : '');

        const clonedMessages = container.cloneNode(true);
        clonedMessages.classList.remove('scroll-shadow');
        clonedMessages.style.overflow = 'visible';
        clonedMessages.style.maxHeight = 'none';
        clonedMessages.style.background = '#fff';

        clonedMessages.querySelectorAll('button').forEach(b => b.remove());

        wrapper.appendChild(title);
        wrapper.appendChild(subtitle);
        wrapper.appendChild(clonedMessages);

        const pad = (n) => String(n).padStart(2, '0');
        const fname = `anova-chat-${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}-${pad(now.getHours())}${pad(now.getMinutes())}.pdf`;

        const opt = {
            margin: [0.5, 0.5, 0.5, 0.5],
            filename: fname,
            image: {type: 'jpeg', quality: 0.95},
            html2canvas: {scale: 2, useCORS: true, logging: false, backgroundColor: '#ffffff'},
            jsPDF: {unit: 'in', format: 'letter', orientation: 'portrait'},
            pagebreak: {mode: ['css', 'legacy'], avoid: ['.bubble pre', '.bubble code']}
        };

        try {
            const dpi = 96;
            const pageHeightPx = (11 - opt.margin[0] - opt.margin[2]) * dpi * opt.html2canvas.scale;
            const approxPages = Math.ceil(wrapper.getBoundingClientRect().height / pageHeightPx);
            if (approxPages > 20) {
                toast(`Chat is too long to export (${approxPages} pages). Please shorten it.`);
                return;
            }
        } catch (_) {
        }

        html2pdf()
            .from(wrapper)
            .set(opt)
            .toPdf()
            .get('pdf')
            .then((pdf) => {
                const pages = pdf.internal.getNumberOfPages();
                if (pages > 20) {
                    toast(`Chat is too long to export (${pages} pages). Please shorten it.`);
                    return;
                }
                pdf.save(opt.filename);
            })
            .catch((e) => {
                console.error(e);
                toast('PDF export failed');
            });
    }

    const INPUT_MIN_PX = 96;
    const INPUT_MAX_PX = 560;
    const INPUT_STEP_PX = 64;

    function applySavedInputHeight() {
        const saved = parseInt(localStorage.getItem('anova_input_h') || '0', 10);
        const h = Number.isFinite(saved) && saved >= INPUT_MIN_PX ? saved : 128;
        const el = document.getElementById('input');
        if (el) el.style.height = Math.max(INPUT_MIN_PX, Math.min(INPUT_MAX_PX, h)) + 'px';
    }

    function adjustInputHeight(dir /* 1 or -1 */) {
        const el = document.getElementById('input');
        if (!el) return;
        const cur = parseInt(getComputedStyle(el).height, 10) || 128;
        const next = Math.max(INPUT_MIN_PX, Math.min(INPUT_MAX_PX, cur + dir * INPUT_STEP_PX));
        el.style.height = next + 'px';
        localStorage.setItem('anova_input_h', String(next));
    }

    document.addEventListener('keydown', (e) => {
        const meta = e.ctrlKey || e.metaKey;
        if (!meta) return;
        if (e.key === '=' || e.key === '+') {
            e.preventDefault();
            adjustInputHeight(1);
        }
        if (e.key === '-') {
            e.preventDefault();
            adjustInputHeight(-1);
        }
    });

    function setSendButtonMode(mode) {
        const b = sendBtn;
        if (!b) return;
        if (mode === "stop") {
            b.textContent = "Stop";
            b.title = "Stop response (Esc)";
            b.classList.remove("bg-bGreen", "hover:bg-bGreenHover");
            b.classList.add("bg-bRed", "hover:bg-bRedHover");
            b.classList.remove("opacity-50", "cursor-not-allowed");
        } else {
            b.textContent = "Send";
            b.title = "Send";
            b.classList.remove("bg-bRed", "hover:bg-bRedHover");
            b.classList.add("bg-bGreen", "hover:bg-bGreenHover");
            b.classList.remove("opacity-50", "cursor-not-allowed");
        }
    }

    function cancelRequest(reason = "Stopped") {
        if (!inflight) return;
        try {
            currentAbort?.abort();
        } catch (_) {
        }
        toast(reason);
    }

    applySavedInputHeight();
</script>

</body>
</html>
